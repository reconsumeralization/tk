import ast

import flake8.main.application
import pylint.lint
import sweep


def analyze_codebase(codebase_dir):
    with open(codebase_dir, 'r') as file:
        code = file.read()

    tree = ast.parse(code)

    pylint_report = pylint.lint.Run([codebase_dir], do_exit=False)
    flake8_app = flake8.main.application.Application()
    flake8_app.run([codebase_dir])
    flake8_report = flake8_app.get_reports()

    improvements = sweep.analyze(tree, pylint_report, flake8_report)

    for improvement in improvements:
        generate_sweep_issue(improvement)

def generate_sweep_issue(improvement):
    issue = sweep.Issue(
        title=f"Code Improvement: {improvement['description']}",
        body=f"Suggested changes: {improvement['suggestion']}"
    )
    issue.save()

if __name__ == "__main__":
    analyze_codebase('path_to_codebase')
